# ds-svelte-community

## Developing this package

Once you've created a project and installed dependencies with `bun install`, start a development server:

> [!TIP]
> You might need to build the other packages first. Run `bun run build:libs` in the root of the project.

```bash
bun run dev # or
bun run test
```

Everything inside `src/lib` is part of the library, everything inside `src/routes` can be used as a showcase or preview app.

## Adding new components

In general, we try to create components that behave like the components in the [React version](https://github.com/navikt/aksel/tree/main/%40navikt/core/react), with a few exceptions:

- Default user facing texts are in English, not Norwegian.
- We try to make the components feel more like Svelte components, and less like React components.

We strive to generate HTML equal to the HTML generated by the React version of the component library.

We ensure this by adding a test for each component, that renders the component and compares the HTML to the HTML generated by the React version.

```typescript
import { render } from "$testlib/render";
import { Loader as ReactLoader } from "@navikt/ds-react";
import { describe, expect, it } from "bun:test";
import Loader from "./Loader.svelte";
import type { LoaderProps } from "./type";

describe("Loader", () => {
	it("renders with HTML similar to ds-react", async () => {
		// Often we can define one structure with props, used by both components.
		// If there's differences, we should pass separate props to each component.
		const props: LoaderProps = {
			title: "Loading",
		};

		// toMimicReact is a custom matcher that checks both the HTML and a visual comparison of the component.
		// toMimicReact will do some alterations to the HTML, e.g. sort attributes, classes and format the html.
		// Start by using the `render` function to render the Svelte component.
		expect(render(Loader, props)).toMimicReact(ReactLoader, {
			props: {
				// Spread the props object, so we can add more props if needed.
				...props,
			},
			opts: {
				// Since this component use animations, the visual comparison will regularly fail.
				// We skip the visual comparison, but still compare the HTML.
				visual: {
					skip: true,
				},
				// There's a few functions that alters the HTML. E.g. this one removes any attribute where the function returns false.
				compareAttrs(node, attr) {
					const tagName = node.tagName.toLowerCase();
					// Title ids are unique
					if (tagName == "svg" && ["aria-labelledby"].includes(attr)) {
						return false;
					}

					if (tagName == "title" && attr == "id") {
						return false;
					}
					return true;
				},
			},
		});
	});
});
```

## Building

To build the library:

```bash
bun run package
```

To create a production version of the showcase app:

```bash
bun run build
```

### TODO

- Stories doesn't include js/ts used in e.g. {#each} blocks;
